<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema M√©dico - Inicio de Sesi√≥n</title>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --admin-color: #9b59b6;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            width: 100%;
            max-width: 400px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .form-container {
            padding: 30px;
            transition: transform 0.5s ease;
        }
        
        .form-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .form-header h1 {
            color: var(--secondary-color);
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .form-header p {
            color: #7f8c8d;
            font-size: 14px;
        }
        
        .user-type-selector {
            display: flex;
            margin-bottom: 20px;
            border-radius: 5px;
            overflow: hidden;
            border: 1px solid #ddd;
        }
        
        .user-type {
            flex: 1;
            padding: 10px;
            text-align: center;
            background-color: #f8f9fa;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }
        
        .user-type.active[data-type="patient"] {
            background-color: var(--primary-color);
            color: white;
        }
        
        .user-type.active[data-type="doctor"] {
            background-color: var(--success-color);
            color: white;
        }
        
        .user-type.active[data-type="admin"] {
            background-color: var(--admin-color);
            color: white;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: var(--secondary-color);
            font-weight: 500;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            transition: border 0.3s;
        }
        
        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary-color);
            outline: none;
        }
        
        .btn {
            display: block;
            width: 100%;
            padding: 12px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .btn:hover {
            background-color: #2980b9;
        }
        
        .form-footer {
            text-align: center;
            margin-top: 20px;
        }
        
        .form-footer a {
            color: var(--primary-color);
            text-decoration: none;
            font-size: 14px;
            margin: 0 5px;
        }
        
        .form-footer a:hover {
            text-decoration: underline;
        }
        
        .hidden {
            display: none;
        }
        
        .form-section {
            display: none;
        }
        
        .form-section.active {
            display: block;
        }
        
        .error-message {
            color: var(--accent-color);
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }
        
        .success-message {
            color: var(--success-color);
            font-size: 14px;
            margin-top: 10px;
            text-align: center;
            display: none;
        }
        
        .password-requirements {
            font-size: 12px;
            color: #7f8c8d;
            margin-top: 5px;
        }
        
        .admin-info {
            background-color: #f8f5ff;
            border-left: 4px solid var(--admin-color);
            padding: 10px 15px;
            margin-bottom: 20px;
            border-radius: 4px;
            font-size: 13px;
            color: #7b5e9b;
        }
        
        @media (max-width: 480px) {
            .container {
                max-width: 100%;
            }
            
            .form-container {
                padding: 20px;
            }
            
            .user-type {
                font-size: 12px;
                padding: 8px 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="form-container">
            <!-- Selector de tipo de usuario -->
            <div class="user-type-selector">
                <div class="user-type active" data-type="patient">Paciente</div>
                <div class="user-type" data-type="doctor">Doctor</div>
                <div class="user-type" data-type="admin">Administrador</div>
            </div>
            
            <!-- Formulario de Inicio de Sesi√≥n -->
            <div id="login-section" class="form-section active">
                <div class="form-header">
                    <h1 id="login-title">Iniciar Sesi√≥n</h1>
                    <p id="login-subtitle">Accede a tu cuenta</p>
                </div>
                
                <!-- Informaci√≥n para administradores -->
                <div id="admin-login-info" class="admin-info hidden">
                    <strong>Acceso administrativo:</strong> Solo personal autorizado puede acceder al panel de administraci√≥n.
                </div>
                
                <form id="login-form">
                    <div class="form-group">
                        <label for="login-email">Correo Electr√≥nico</label>
                        <input type="email" id="login-email" required>
                        <div class="error-message" id="login-email-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="login-password">Contrase√±a</label>
                        <input type="password" id="login-password" required>
                        <div class="error-message" id="login-password-error"></div>
                    </div>
                    
                    <button type="submit" class="btn" id="login-button">Iniciar Sesi√≥n</button>
                </form>
                
                <div class="form-footer">
                    <a href="#" id="show-register">Crear una cuenta</a>
                    <a href="#" id="show-forgot">¬øOlvidaste tu contrase√±a?</a>
                </div>
            </div>
            
            <!-- Formulario de Registro -->
            <div id="register-section" class="form-section">
                <div class="form-header">
                    <h1 id="register-title">Registrarse</h1>
                    <p id="register-subtitle">Crea una nueva cuenta</p>
                </div>
                
                <!-- Informaci√≥n para administradores -->
                <div id="admin-register-info" class="admin-info hidden">
                    <strong>Registro de administradores:</strong> Solo usuarios con permisos especiales pueden crear cuentas de administrador.
                </div>
                
                <!-- Formulario de Registro para Pacientes -->
                <form id="patient-register-form">
                    <div class="form-group">
                        <label for="patient-name">Nombre Completo</label>
                        <input type="text" id="patient-name" required>
                        <div class="error-message" id="patient-name-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="patient-email">Correo Electr√≥nico</label>
                        <input type="email" id="patient-email" required>
                        <div class="error-message" id="patient-email-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="patient-phone">Tel√©fono</label>
                        <input type="tel" id="patient-phone" required>
                        <div class="error-message" id="patient-phone-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="patient-birthdate">Fecha de Nacimiento</label>
                        <input type="date" id="patient-birthdate" required>
                        <div class="error-message" id="patient-birthdate-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="patient-gender">G√©nero</label>
                        <select id="patient-gender" required>
                            <option value="">Selecciona</option>
                            <option value="male">Masculino</option>
                            <option value="female">Femenino</option>
                            <option value="other">Otro</option>
                        </select>
                        <div class="error-message" id="patient-gender-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="patient-password">Contrase√±a</label>
                        <input type="password" id="patient-password" required>
                        <div class="error-message" id="patient-password-error"></div>
                        <div class="password-requirements">
                            La contrase√±a debe tener al menos 8 caracteres, incluyendo una may√∫scula, un n√∫mero y un car√°cter especial.
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="patient-confirm-password">Confirmar Contrase√±a</label>
                        <input type="password" id="patient-confirm-password" required>
                        <div class="error-message" id="patient-confirm-password-error"></div>
                    </div>
                    
                    <button type="submit" class="btn">Registrarse</button>
                </form>
                
                <!-- Formulario de Registro para Doctores -->
                <form id="doctor-register-form" class="hidden">
                    <div class="form-group">
                        <label for="doctor-name">Nombre Completo</label>
                        <input type="text" id="doctor-name" required>
                        <div class="error-message" id="doctor-name-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="doctor-email">Correo Electr√≥nico</label>
                        <input type="email" id="doctor-email" required>
                        <div class="error-message" id="doctor-email-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="doctor-phone">Tel√©fono</label>
                        <input type="tel" id="doctor-phone" required>
                        <div class="error-message" id="doctor-phone-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="doctor-specialty">Especialidad</label>
                        <input type="text" id="doctor-specialty" required>
                        <div class="error-message" id="doctor-specialty-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="doctor-license">N√∫mero de Licencia</label>
                        <input type="text" id="doctor-license" required>
                        <div class="error-message" id="doctor-license-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="doctor-hospital">Hospital/Cl√≠nica</label>
                        <input type="text" id="doctor-hospital" required>
                        <div class="error-message" id="doctor-hospital-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="doctor-password">Contrase√±a</label>
                        <input type="password" id="doctor-password" required>
                        <div class="error-message" id="doctor-password-error"></div>
                        <div class="password-requirements">
                            La contrase√±a debe tener al menos 8 caracteres, incluyendo una may√∫scula, un n√∫mero y un car√°cter especial.
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="doctor-confirm-password">Confirmar Contrase√±a</label>
                        <input type="password" id="doctor-confirm-password" required>
                        <div class="error-message" id="doctor-confirm-password-error"></div>
                    </div>
                    
                    <button type="submit" class="btn">Registrarse</button>
                </form>
                
                <!-- Formulario de Registro para Administradores -->
                <form id="admin-register-form" class="hidden">
                    <div class="admin-info">
                        <strong>Importante:</strong> Las cuentas de administrador requieren verificaci√≥n especial. 
                        Solo el personal autorizado puede crear estas cuentas.
                    </div>
                    
                    <div class="form-group">
                        <label for="admin-name">Nombre Completo</label>
                        <input type="text" id="admin-name" required>
                        <div class="error-message" id="admin-name-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="admin-email">Correo Electr√≥nico</label>
                        <input type="email" id="admin-email" required>
                        <div class="error-message" id="admin-email-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="admin-phone">Tel√©fono</label>
                        <input type="tel" id="admin-phone" required>
                        <div class="error-message" id="admin-phone-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="admin-department">Departamento</label>
                        <select id="admin-department" required>
                            <option value="">Selecciona departamento</option>
                            <option value="sistemas">Sistemas</option>
                            <option value="administracion">Administraci√≥n</option>
                            <option value="recursos-humanos">Recursos Humanos</option>
                            <option value="gerencia">Gerencia</option>
                            <option value="calidad">Calidad</option>
                        </select>
                        <div class="error-message" id="admin-department-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="admin-code">C√≥digo de Verificaci√≥n</label>
                        <input type="text" id="admin-code" required placeholder="C√≥digo especial para administradores">
                        <div class="error-message" id="admin-code-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="admin-password">Contrase√±a</label>
                        <input type="password" id="admin-password" required>
                        <div class="error-message" id="admin-password-error"></div>
                        <div class="password-requirements">
                            La contrase√±a debe tener al menos 10 caracteres, incluyendo una may√∫scula, un n√∫mero y un car√°cter especial.
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="admin-confirm-password">Confirmar Contrase√±a</label>
                        <input type="password" id="admin-confirm-password" required>
                        <div class="error-message" id="admin-confirm-password-error"></div>
                    </div>
                    
                    <button type="submit" class="btn">Solicitar Registro</button>
                </form>
                
                <div class="form-footer">
                    <a href="#" id="show-login">¬øYa tienes una cuenta? Inicia sesi√≥n</a>
                </div>
            </div>
            
            <!-- Formulario de Recuperaci√≥n de Contrase√±a -->
            <div id="forgot-section" class="form-section">
                <div class="form-header">
                    <h1>Recuperar Contrase√±a</h1>
                    <p>Ingresa tu correo para recuperar tu contrase√±a</p>
                </div>
                
                <form id="forgot-form">
                    <div class="form-group">
                        <label for="forgot-email">Correo Electr√≥nico</label>
                        <input type="email" id="forgot-email" required>
                        <div class="error-message" id="forgot-email-error"></div>
                    </div>
                    
                    <button type="submit" class="btn">Enviar Instrucciones</button>
                </form>
                
                <div class="success-message" id="forgot-success">
                    Se han enviado las instrucciones para recuperar tu contrase√±a a tu correo electr√≥nico.
                </div>
                
                <div class="form-footer">
                    <a href="#" id="show-login-from-forgot">Volver al inicio de sesi√≥n</a>
                </div>
            </div>
        </div>
    </div>

   <script>
    // Elementos del DOM
    const userTypeSelector = document.querySelectorAll('.user-type');
    const formSections = document.querySelectorAll('.form-section');
    const patientRegisterForm = document.getElementById('patient-register-form');
    const doctorRegisterForm = document.getElementById('doctor-register-form');
    const adminRegisterForm = document.getElementById('admin-register-form');
    const adminLoginInfo = document.getElementById('admin-login-info');
    const adminRegisterInfo = document.getElementById('admin-register-info');
    const loginTitle = document.getElementById('login-title');
    const loginSubtitle = document.getElementById('login-subtitle');
    const registerTitle = document.getElementById('register-title');
    const registerSubtitle = document.getElementById('register-subtitle');
    const loginButton = document.getElementById('login-button');
    
    // Mostrar/ocultar secciones
    document.getElementById('show-register').addEventListener('click', function(e) {
        e.preventDefault();
        showSection('register-section');
        updateRegisterForm();
    });
    
    document.getElementById('show-forgot').addEventListener('click', function(e) {
        e.preventDefault();
        showSection('forgot-section');
    });
    
    document.getElementById('show-login').addEventListener('click', function(e) {
        e.preventDefault();
        showSection('login-section');
        updateLoginUI();
    });
    
    document.getElementById('show-login-from-forgot').addEventListener('click', function(e) {
        e.preventDefault();
        showSection('login-section');
        updateLoginUI();
    });
    
    // Cambiar tipo de usuario
    userTypeSelector.forEach(type => {
        type.addEventListener('click', function() {
            userTypeSelector.forEach(t => t.classList.remove('active'));
            this.classList.add('active');
            
            // Actualizar la interfaz seg√∫n el tipo de usuario
            updateLoginUI();
            
            // Si estamos en la secci√≥n de registro, actualizar el formulario
            if (document.getElementById('register-section').classList.contains('active')) {
                updateRegisterForm();
            }
        });
    });
    
    // Funci√≥n para mostrar secci√≥n
    function showSection(sectionId) {
        formSections.forEach(section => {
            section.classList.remove('active');
        });
        document.getElementById(sectionId).classList.add('active');
        
        // Actualizar la interfaz seg√∫n el tipo de usuario
        if (sectionId === 'login-section') {
            updateLoginUI();
        }
    }
    
    // Actualizar formulario de registro seg√∫n el tipo de usuario
    function updateRegisterForm() {
        const activeType = document.querySelector('.user-type.active').getAttribute('data-type');
        
        // Ocultar todos los formularios primero
        patientRegisterForm.classList.add('hidden');
        doctorRegisterForm.classList.add('hidden');
        adminRegisterForm.classList.add('hidden');
        adminRegisterInfo.classList.add('hidden');
        
        // Mostrar el formulario correspondiente
        if (activeType === 'patient') {
            patientRegisterForm.classList.remove('hidden');
            registerTitle.textContent = 'Registrarse como Paciente';
            registerSubtitle.textContent = 'Crea una nueva cuenta de paciente';
        } else if (activeType === 'doctor') {
            doctorRegisterForm.classList.remove('hidden');
            registerTitle.textContent = 'Registrarse como Doctor';
            registerSubtitle.textContent = 'Crea una nueva cuenta de doctor';
        } else if (activeType === 'admin') {
            adminRegisterForm.classList.remove('hidden');
            adminRegisterInfo.classList.remove('hidden');
            registerTitle.textContent = 'Registro de Administrador';
            registerSubtitle.textContent = 'Solicitar cuenta de administrador';
        }
    }
    
    // Actualizar la interfaz de login seg√∫n el tipo de usuario
    function updateLoginUI() {
        const activeType = document.querySelector('.user-type.active').getAttribute('data-type');
        
        if (activeType === 'patient') {
            loginTitle.textContent = 'Iniciar Sesi√≥n como Paciente';
            loginSubtitle.textContent = 'Accede a tu cuenta de paciente';
            loginButton.textContent = 'Iniciar Sesi√≥n';
            adminLoginInfo.classList.add('hidden');
        } else if (activeType === 'doctor') {
            loginTitle.textContent = 'Iniciar Sesi√≥n como Doctor';
            loginSubtitle.textContent = 'Accede a tu cuenta de doctor';
            loginButton.textContent = 'Iniciar Sesi√≥n';
            adminLoginInfo.classList.add('hidden');
        } else if (activeType === 'admin') {
            loginTitle.textContent = 'Acceso de Administrador';
            loginSubtitle.textContent = 'Panel de control del sistema';
            loginButton.textContent = 'Acceder al Panel Admin';
            adminLoginInfo.classList.remove('hidden');
        }
    }

    // ========== CONEXI√ìN CON BACKEND ==========
    
    // Registro de pacientes
    document.getElementById('patient-register-form').addEventListener('submit', function(e) {
        e.preventDefault();
        if (validatePatientRegisterForm()) {
            registerUser('patient');
        }
    });
    
    // Registro de doctores
    document.getElementById('doctor-register-form').addEventListener('submit', function(e) {
        e.preventDefault();
        if (validateDoctorRegisterForm()) {
            registerUser('doctor');
        }
    });
    
    // Registro de administradores
    document.getElementById('admin-register-form').addEventListener('submit', function(e) {
        e.preventDefault();
        if (validateAdminRegisterForm()) {
            registerUser('admin');
        }
    });
    
    // Login
    document.getElementById('login-form').addEventListener('submit', function(e) {
        e.preventDefault();
        if (validateLoginForm()) {
            loginUser();
        }
    });
    
    // Recuperaci√≥n de contrase√±a
    document.getElementById('forgot-form').addEventListener('submit', async function(e) {
        e.preventDefault();
        if (validateForgotForm()) {
            const email = document.getElementById('forgot-email').value.trim();
            try {
                const res = await fetch('/api/recover', {
                    method: 'POST',
                    headers: {'Content-Type':'application/json'},
                    body: JSON.stringify({ email })
                });
                const data = await res.json();
                if (res.ok && data.success) {
                    document.getElementById('forgot-success').style.display = 'block';
                    document.getElementById('forgot-success').textContent = 'Se ha enviado la contrase√±a a tu correo.';
                } else {
                    const msg = data && data.message ? data.message : 'No se pudo enviar el correo.';
                    showError('forgot-email-error', msg);
                }
            } catch (err) {
                console.error(err);
                showError('forgot-email-error', 'Error al comunicarse con el servidor.');
            }
        }
    });

    // ========== FUNCIONES DE REGISTRO Y LOGIN ==========
    
    function registerUser(userType) {
        let userData = {};
        
        if (userType === 'patient') {
            userData = {
                tipo: 'paciente',
                nombre: document.getElementById('patient-name').value,
                email: document.getElementById('patient-email').value,
                password: document.getElementById('patient-password').value,
                telefono: document.getElementById('patient-phone').value,
                fecha_nacimiento: document.getElementById('patient-birthdate').value,
                genero: document.getElementById('patient-gender').value
            };
        } else if (userType === 'doctor') {
            userData = {
                tipo: 'doctor',
                nombre: document.getElementById('doctor-name').value,
                email: document.getElementById('doctor-email').value,
                password: document.getElementById('doctor-password').value,
                telefono: document.getElementById('doctor-phone').value,
                especialidad: document.getElementById('doctor-specialty').value,
                licencia: document.getElementById('doctor-license').value,
                hospital: document.getElementById('doctor-hospital').value
            };
        } else if (userType === 'admin') {
            userData = {
                tipo: 'admin',
                nombre: document.getElementById('admin-name').value,
                email: document.getElementById('admin-email').value,
                password: document.getElementById('admin-password').value,
                telefono: document.getElementById('admin-phone').value,
                departamento: document.getElementById('admin-department').value,
                codigo_verificacion: document.getElementById('admin-code').value
            };
        }
        
        console.log('Enviando datos de registro:', userData);
        
        // Enviar al backend
        fetch('api/registro.php', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(userData)
        })
        .then(response => response.json())
        .then(data => {
            console.log('Respuesta del servidor:', data);
            if (data.success) {
                alert('‚úÖ ' + data.message);
                showSection('login-section');
            } else {
                alert('‚ùå ' + data.message);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('‚ùå Error al conectar con el servidor');
        });
    }
    
    function loginUser() {
        const loginData = {
            email: document.getElementById('login-email').value,
            password: document.getElementById('login-password').value
        };
        
        console.log('Enviando datos de login:', loginData);
        
        fetch('api/login.php', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(loginData)
        })
        .then(response => response.json())
        .then(data => {
            console.log('Respuesta del login:', data);
            if (data.success) {
                alert('‚úÖ ' + data.message);
                // Redirigir a la p√°gina correspondiente
                window.location.href = data.redirect;
            } else {
                alert('‚ùå ' + data.message);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('‚ùå  conectar con el servidor');
        });
    }

    // ========== FUNCIONES DE VALIDACI√ìN CORREGIDAS ==========
    
    function validateLoginForm() {
        let isValid = true;
        const email = document.getElementById('login-email').value;
        const password = document.getElementById('login-password').value;
        
        // Validar email
        if (!validateEmail(email)) {
            showError('login-email-error', 'Por favor ingresa un correo electr√≥nico v√°lido');
            isValid = false;
        } else {
            hideError('login-email-error');
        }
        
        // Validar contrase√±a (m√≠nimo 6 caracteres para login)
        if (password.length < 6) {
            showError('login-passError alword-error', 'La contrase√±a debe tener al menos 6 caracteres');
            isValid = false;
        } else {
            hideError('login-password-error');
        }
        
        return isValid;
    }
    
    function validatePatientRegisterForm() {
        let isValid = true;
        
        // Validar nombre
        const name = document.getElementById('patient-name').value;
        if (name.trim().length < 2) {
            showError('patient-name-error', 'El nombre debe tener al menos 2 caracteres');
            isValid = false;
        } else {
            hideError('patient-name-error');
        }
        
        // Validar email
        const email = document.getElementById('patient-email').value;
        if (!validateEmail(email)) {
            showError('patient-email-error', 'Por favor ingresa un correo electr√≥nico v√°lido');
            isValid = false;
        } else {
            hideError('patient-email-error');
        }
        
        // Validar tel√©fono
        const phone = document.getElementById('patient-phone').value;
        if (!validatePhone(phone)) {
            showError('patient-phone-error', 'Por favor ingresa un n√∫mero de tel√©fono v√°lido');
            isValid = false;
        } else {
            hideError('patient-phone-error');
        }
        
        // Validar fecha de nacimiento
        const birthdate = document.getElementById('patient-birthdate').value;
        if (!birthdate) {
            showError('patient-birthdate-error', 'Por favor ingresa tu fecha de nacimiento');
            isValid = false;
        } else {
            hideError('patient-birthdate-error');
        }
        
        // Validar g√©nero
        const gender = document.getElementById('patient-gender').value;
        if (!gender) {
            showError('patient-gender-error', 'Por favor selecciona tu g√©nero');
            isValid = false;
        } else {
            hideError('patient-gender-error');
        }
        
        // Validar contrase√±a - REGEX CORREGIDA
        const password = document.getElementById('patient-password').value;
        if (!validatePassword(password)) {
            showError('patient-password-error', 'La contrase√±a debe tener al menos 8 caracteres, incluyendo una may√∫scula, un n√∫mero y un car√°cter especial');
            isValid = false;
        } else {
            hideError('patient-password-error');
        }
        
        // Validar confirmaci√≥n de contrase√±a
        const confirmPassword = document.getElementById('patient-confirm-password').value;
        if (password !== confirmPassword) {
            showError('patient-confirm-password-error', 'Las contrase√±as no coinciden');
            isValid = false;
        } else {
            hideError('patient-confirm-password-error');
        }
        
        return isValid;
    }
    
    function validateDoctorRegisterForm() {
        let isValid = true;
        
        // Validar nombre
        const name = document.getElementById('doctor-name').value;
        if (name.trim().length < 2) {
            showError('doctor-name-error', 'El nombre debe tener al menos 2 caracteres');
            isValid = false;
        } else {
            hideError('doctor-name-error');
        }
        
        // Validar email
        const email = document.getElementById('doctor-email').value;
        if (!validateEmail(email)) {
            showError('doctor-email-error', 'Por favor ingresa un correo electr√≥nico v√°lido');
            isValid = false;
        } else {
            hideError('doctor-email-error');
        }
        
        // Validar tel√©fono
        const phone = document.getElementById('doctor-phone').value;
        if (!validatePhone(phone)) {
            showError('doctor-phone-error', 'Por favor ingresa un n√∫mero de tel√©fono v√°lido');
            isValid = false;
        } else {
            hideError('doctor-phone-error');
        }
        
        // Validar especialidad
        const specialty = document.getElementById('doctor-specialty').value;
        if (!specialty.trim()) {
            showError('doctor-specialty-error', 'Por favor ingresa tu especialidad');
            isValid = false;
        } else {
            hideError('doctor-specialty-error');
        }
        
        // Validar licencia
        const license = document.getElementById('doctor-license').value;
        if (!license.trim()) {
            showError('doctor-license-error', 'Por favor ingresa tu n√∫mero de licencia');
            isValid = false;
        } else {
            hideError('doctor-license-error');
        }
        
        // Validar hospital/cl√≠nica
        const hospital = document.getElementById('doctor-hospital').value;
        if (!hospital.trim()) {
            showError('doctor-hospital-error', 'Por favor ingresa tu hospital o cl√≠nica');
            isValid = false;
        } else {
            hideError('doctor-hospital-error');
        }
        
        // Validar contrase√±a - REGEX CORREGIDA
        const password = document.getElementById('doctor-password').value;
        if (!validatePassword(password)) {
            showError('doctor-password-error', 'La contrase√±a debe tener al menos 8 caracteres, incluyendo una may√∫scula, un n√∫mero y un car√°cter especial');
            isValid = false;
        } else {
            hideError('doctor-password-error');
        }
        
        // Validar confirmaci√≥n de contrase√±a
        const confirmPassword = document.getElementById('doctor-confirm-password').value;
        if (password !== confirmPassword) {
            showError('doctor-confirm-password-error', 'Las contrase√±as no coinciden');
            isValid = false;
        } else {
            hideError('doctor-confirm-password-error');
        }
        
        return isValid;
    }
    
    function validateAdminRegisterForm() {
        let isValid = true;
        
        // Validar nombre
        const name = document.getElementById('admin-name').value;
        if (name.trim().length < 2) {
            showError('admin-name-error', 'El nombre debe tener al menos 2 caracteres');
            isValid = false;
        } else {
            hideError('admin-name-error');
        }
        
        // Validar email
        const email = document.getElementById('admin-email').value;
        if (!validateEmail(email)) {
            showError('admin-email-error', 'Por favor ingresa un correo electr√≥nico v√°lido');
            isValid = false;
        } else {
            hideError('admin-email-error');
        }
        
        // Validar tel√©fono
        const phone = document.getElementById('admin-phone').value;
        if (!validatePhone(phone)) {
            showError('admin-phone-error', 'Por favor ingresa un n√∫mero de tel√©fono v√°lido');
            isValid = false;
        } else {
            hideError('admin-phone-error');
        }
        
        // Validar departamento
        const department = document.getElementById('admin-department').value;
        if (!department) {
            showError('admin-department-error', 'Por favor selecciona tu departamento');
            isValid = false;
        } else {
            hideError('admin-department-error');
        }
        
        // Validar c√≥digo de verificaci√≥n
        const code = document.getElementById('admin-code').value;
        if (!code.trim()) {
            showError('admin-code-error', 'Por favor ingresa el c√≥digo de verificaci√≥n');
            isValid = false;
        } else {
            hideError('admin-code-error');
        }
        
        // Validar contrase√±a (m√°s estricta para administradores) - REGEX CORREGIDA
        const password = document.getElementById('admin-password').value;
        if (!validateAdminPassword(password)) {
            showError('admin-password-error', 'La contrase√±a debe tener al menos 10 caracteres, incluyendo una may√∫scula, un n√∫mero y un car√°cter especial');
            isValid = false;
        } else {
            hideError('admin-password-error');
        }
        
        // Validar confirmaci√≥n de contrase√±a
        const confirmPassword = document.getElementById('admin-confirm-password').value;
        if (password !== confirmPassword) {
            showError('admin-confirm-password-error', 'Las contrase√±as no coinciden');
            isValid = false;
        } else {
            hideError('admin-confirm-password-error');
        }
        
        return isValid;
    }
    
    function validateForgotForm() {
        let isValid = true;
        const email = document.getElementById('forgot-email').value;
        
        if (!validateEmail(email)) {
            showError('forgot-email-error', 'Por favor ingresa un correo electr√≥nico v√°lido');
            isValid = false;
        } else {
            hideError('forgot-email-error');
        }
        
        return isValid;
    }
    
    // ========== FUNCIONES AUXILIARES DE VALIDACI√ìN CORREGIDAS ==========
    
    function validateEmail(email) {
        const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return re.test(email);
    }
    
    function validatePhone(phone) {
        const re = /^[0-9+\-\s()]{10,}$/;
        return re.test(phone);
    }
    
    // REGEX CORREGIDA - Ahora funciona correctamente
    function validatePassword(password) {
        // Al menos 8 caracteres, una may√∫scula, un n√∫mero y un car√°cter especial
        const re = /^(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]).{8,}$/;
        return re.test(password);
    }
    
    // REGEX CORREGIDA - Ahora funciona correctamente
    function validateAdminPassword(password) {
        // Al menos 10 caracteres, una may√∫scula, un n√∫mero y un car√°cter especial (m√°s estricto)
        const re = /^(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]).{10,}$/;
        return re.test(password);
    }
    
    function showError(elementId, message) {
        const errorElement = document.getElementById(elementId);
        errorElement.textContent = message;
        errorElement.style.display = 'block';
    }
    
    function hideError(elementId) {
        const errorElement = document.getElementById(elementId);
        errorElement.style.display = 'none';
    }
    
    // Inicializar la interfaz
    updateLoginUI();

    // ========== EJEMPLOS DE CONTRASE√ëAS V√ÅLIDAS PARA PROBAR ==========
    console.log('Ejemplos de contrase√±as v√°lidas:');
    console.log('Para pacientes/doctores: "Password123!"');
    console.log('Para administradores: "AdminPassword123!"');
</script>
<script src="api-client.js"></script>
<script type="module">
  import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'

  const supabaseUrl = import.meta.env.VITE_SUPABASE_URL || 'TU_SUPABASE_URL'
  const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY || 'TU_SUPABASE_KEY'
  const supabase = createClient(supabaseUrl, supabaseAnonKey)

  document.getElementById('forgotPassword').addEventListener('click', async (e) => {
    e.preventDefault()
    const email = document.getElementById('email').value.trim()
    if (!email) {
      alert('Por favor, introduce tu correo electr√≥nico.')
      return
    }

    const { error } = await supabase.auth.resetPasswordForEmail(email, {
      redirectTo: 'http://localhost:3000/reset-password.html',
    })

    if (error) alert('‚ùå Error al enviar el correo: ' + error.message)
    else alert('üìß Se ha enviado un enlace para restablecer tu contrase√±a.')
  })
</script>

</body>
</html>
